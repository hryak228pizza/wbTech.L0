# L0. Order service
Демонстрационный сервис с простейшим интерфейсом, отображающий данные о заказе. 
## Запуск
1. Скопируйте репозиторий
```shell
git clone github.com/hryak228pizza/wbTech.L0
```
2. В корне проекта у Вас должен быть файл .env. Установите в него необходимые для Вас параметры. Используйте .env.template как пример
3. Запустите контейнеры
```shell
docker compose up -d
или docker compose up -d --build
```
## Точки взаимдействия
- _http://localhost:8080/_ - интерфейс для ввода и чтения заказа по UID
- _http://localhost:8080/swagger_ - страница с документацией
- _http://localhost:8088/_ - интерфейс брокера сообщений с подробной информацией
- _http://localhost:5050/_ - панель управления базой данных. Логин admin@example.com, пароль admin.
## Архитектура
В проекте используется следующий стек технологий:
- __Go__
- __html/js__
- __kafka__
- __postgreSQL__
- __swagger__
***
На веб странице в поле ввода вводится Id заказа. После нажатия кнопки Get срабатывает обработчик, который отправляет get запрос на /order/{id}.   
Когда на наш сервис приходит get запрос, сервис возвращает json этого заказа, причем делает это разными способами: если id заказа есть в кэше - берет оттуда, иначе - идет в БД и подтягивает данные уже из нее, при этом этот заказ помещается в кэш. При успехе возвращается json c кодом 200, иначе 404 в случае, если заказа такого нет.   
Параллельно с этим приходят заказы в брокер. Сервис их читает, проверяет на валидность, сохраняет новый заказ в кэш и в БД.   

## Структура проекта
- __./cmd/main.go__ - точка входа.
- __./internal/config__ - обработка конфигурационнных файлов сервиса (из .env).
- __./internal/generator__ - генератор заказов. Используется для продюсера брокера как симуляция новых заказов, которые создают пользователи.
- __./internal/infrastucture__ - миграции и запросы для базы данных.
- __./internal/logger__ - реализация логгера через [zap](https://pkg.go.dev/go.uber.org/zap).
- __./internal/model__ - модель данных заказа.
- __./internal/transport/handler__ - реализация обработчика запросов на сервисе по эндпоинтам "/" и "/order/". Здесь же папка с документацией, сгенерированной при помощи [swagger](https://github.com/swaggo/swag).
- __./internal/transport/kafka__ - реализация продюсера и консьюмера брокера.
- __./pkg/cache__ - реализация кеша при помощи [golang-lru](https://github.com/hashicorp/golang-lru).
- __./pkg/validation__ - реализация валидатора данных при помощи [validator](https://github.com/go-playground/validator).
- __./templates__ - шаблон для веб-страниц.

## Что изменилось?
- Прогнал проект через goimports
- Больше нет необрабатываемых ошибок
- Отрефакторил метод NewCahce с использованием sqlc
- Миграции, которые раньше не использовались, теперь используются для генерации sqlc
- Теперь вся инфраструктра запускается вместе
- zookeeper был заменен на kraft
- Оставшиеся данные вынесены в конфиг
- Больше нет устаревших и запрещенных методов
- Валидируются все данные
- Программа завершается изящно
- Предусмотрен механизм наката и отката миграций через Makefile (с использованием [goose](https://github.com/pressly/goose))
- Добавлены интерфейсы для работы с базой данных

## Что еще нужно изменить?
___
- Добавить тестов
- Реализовать DLQ
- Реализовать Retry
- Добавить трейсинг
- Добавить метрики
- Затащить линтер в проект
